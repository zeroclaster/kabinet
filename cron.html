<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ручной автовыполнитель v1.0</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
        }

        .status-container {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .log-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background-color: #fff;
        }

        .log-entry {
            padding: 8px;
            margin: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .log-entry.success {
            border-left: 4px solid #4CAF50;
        }

        .log-entry.error {
            border-left: 4px solid #f44336;
        }

        .timestamp {
            color: #666;
            font-size: 0.9em;
        }

        .status {
            font-weight: bold;
        }

        .success {
            color: #4CAF50;
        }

        .error {
            color: #f44336;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Ручной автовыполнитель v1.0</h1>

    <div class="status-container">
        <h3>Текущий статус:</h3>
        <div id="currentStatus">Ожидание первого запроса...</div>
        <div id="nextRequest">Следующий запрос через: <span id="countdown">5:00</span></div>
    </div>

    <h3>История запросов:</h3>
    <div class="log-container" id="logContainer">
        <!-- Сюда будут добавляться записи о запросах -->
    </div>

    <div style="margin-top: 20px; text-align: center;">
        <button onclick="makeRequest()" style="padding: 10px 20px; margin: 5px;">Выполнить запрос сейчас</button>
        <button onclick="clearLog()" style="padding: 10px 20px; margin: 5px; background-color: #ffeb3b;">Очистить историю</button>
    </div>
</div>

<script>
    let requestInterval;
    let countdownInterval;
    let countdownTime = 300; // 5 минут в секундах

    // Функция для форматирования времени
    function formatTime(date) {
        return date.toLocaleTimeString('ru-RU');
    }

    // Функция для добавления записи в лог
    function addLogEntry(status, message, timestamp) {
        const logContainer = document.getElementById('logContainer');
        const logEntry = document.createElement('div');
        logEntry.className = `log-entry ${status === 'success' ? 'success' : 'error'}`;

        logEntry.innerHTML = `
                <div class="timestamp">${formatTime(timestamp)}</div>
                <div class="status ${status}">Статус: ${message}</div>
            `;

        logContainer.prepend(logEntry); // Добавляем в начало

        // Прокручиваем к верху
        logContainer.scrollTop = 0;
    }

    // Функция для выполнения запроса
    async function makeRequest() {
        const url = 'https://kupi-otziv.ru/cron/cron1.php';
        const timestamp = new Date();

        try {
            document.getElementById('currentStatus').innerHTML =
                `Выполняется запрос... (${formatTime(timestamp)})`;

            const response = await fetch(url, {
                method: 'GET',
                mode: 'no-cors' // Для обхода CORS, если необходимо
            });

            // Поскольку мы используем no-cors, мы не можем прочитать ответ,
            // но можем определить успешность запроса
            const statusText = response.ok ? 'Успешно' : `Ошибка: ${response.status}`;

            document.getElementById('currentStatus').innerHTML =
                `Последний запрос: ${formatTime(timestamp)} - ${statusText}`;

            addLogEntry('success', `Запрос выполнен - ${statusText}`, timestamp);

        } catch (error) {
            const errorMessage = `Ошибка: ${error.message}`;
            document.getElementById('currentStatus').innerHTML =
                `Последний запрос: ${formatTime(timestamp)} - ${errorMessage}`;

            addLogEntry('error', errorMessage, timestamp);
        }

        // Сбрасываем счетчик
        resetCountdown();
    }

    // Функция для сброса счетчика
    function resetCountdown() {
        countdownTime = 300; // 5 минут
        updateCountdownDisplay();
    }

    // Функция для обновления отображения счетчика
    function updateCountdownDisplay() {
        const minutes = Math.floor(countdownTime / 60);
        const seconds = countdownTime % 60;
        document.getElementById('countdown').textContent =
            `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    // Функция для очистки лога
    function clearLog() {
        document.getElementById('logContainer').innerHTML = '';
    }

    // Запуск при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
        // Выполняем первый запрос сразу
        makeRequest();

        // Запускаем интервал для запросов каждые 5 минут
        requestInterval = setInterval(makeRequest, 300000); // 300000 мс = 5 минут

        // Запускаем счетчик
        countdownInterval = setInterval(function() {
            countdownTime--;
            updateCountdownDisplay();

            if (countdownTime <= 0) {
                resetCountdown();
            }
        }, 1000);
    });

    // Очистка интервалов при закрытии страницы (на всякий случай)
    window.addEventListener('beforeunload', function() {
        if (requestInterval) clearInterval(requestInterval);
        if (countdownInterval) clearInterval(countdownInterval);
    });
</script>
</body>
</html>